<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>PSC Dashboard ‚Äì Help</title>
  <style>
    /* ================= THEME ================= */
    :root{
      --bg:#faf9ff; --panel:#ffffff; --border:#e4dcff; --ink:#2f2a44;
      --ink-soft:#6b5f87; --ink-muted:#8c7ba8; --brand:#7030A0; --brand-soft:#efeaff;
      --thead:#faf7ff; --chip-bg:#f4f3ff;
      --num:#4b2a7a; --link:#6a46ff;

      --chart-rf:#6a46ff; --chart-sam:#9b78ff; --chart-all:#c9b6e4;
      --hbar-track:#f1edff; --hbar-fill:#9b78ff;
      --green:#16a34a; --red:#dc2626;

      --accent:#ff7a59; --accent-soft:rgba(255,122,89,.12);
      --tri-green:#2e7d32; --tri-green-dark:#1b5e20;
    }
    body.dark{
      --bg:#0f1020; --panel:#16172a; --border:#2a2c45; --ink:#e8e6ff;
      --ink-soft:#c9c4ea; --ink-muted:#a59fcc; --brand:#a78bfa; --brand-soft:#262348;
      --thead:#1b1c33; --chip-bg:#1e1f39;
      --num:#a78bfa; --link:#bda7ff;

      --chart-rf:#8b78ff; --chart-sam:#b8a5ff; --chart-all:#8b93b9;
      --hbar-track:#252747; --hbar-fill:#b8a5ff;

      --accent:#ffa382; --tri-green:#43a047; --tri-green-dark:#2e7d32;
    }

    /* ================= BASE ================= */
    html,body{height:100%}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans',sans-serif;color:var(--ink);background:var(--bg);margin:0}
    .topbar{display:flex;gap:16px;justify-content:space-between;align-items:center;padding:12px 16px;background:var(--panel);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:10}
    .brand{display:flex;gap:12px;align-items:center}
    .brand .logo{width:28px;height:28px;background:var(--chip-bg);border-radius:6px}
    .brand h1{font-size:16px;margin:0;color:var(--brand)}
    .brand small{color:var(--ink-muted)}
    .tabs a{margin:0 6px;text-decoration:none;color:var(--ink-soft);padding:6px 10px;border-radius:8px}
    .tabs a.active{background:var(--brand-soft);color:var(--brand)}
    .theme-toggle{border:1px solid var(--border);background:transparent;color:var(--ink);border-radius:8px;padding:6px 10px;cursor:pointer}

    main{max-width:1200px;margin:18px auto;padding:0 16px}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;margin-bottom:24px}
    .panel h2{margin:0 0 12px 0;color:var(--brand);font-size:18px}
    .site-footer{max-width:1200px;margin:0 auto 24px auto;color:var(--ink-muted);text-align:center;font-size:12px}

    /* ===== Buttons (aligned with theme) ===== */
    .btn{padding:6px 10px;font-size:13px;border:1px solid var(--border);border-radius:8px;background:var(--panel);color:var(--ink);cursor:pointer}
    .btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
    .btn.ghost{background:transparent}
    .btn.danger{background:var(--red);border-color:var(--red);color:#fff}
    .btn:disabled{opacity:.6;cursor:not-allowed}

    /* ===== Simple grid for two columns ===== */
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    @media (max-width:900px){ .grid-2{grid-template-columns:1fr} }

    /* ===== Code-like small blocks ===== */
    .kbd{display:inline-block;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;font-size:12px;border:1px solid var(--border);border-radius:6px;background:var(--thead);color:var(--ink);padding:0 6px}
    pre{background:var(--thead);padding:10px;border-radius:10px;border:1px solid var(--border);overflow:auto}

    /* ===== Modal (same look as Dashboard) ===== */
    .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,.35);
      display:none; align-items:center; justify-content:center; z-index:9999; }
    .modal{ width:min(540px, 92vw); max-height:80vh; overflow:auto; background:var(--panel); color:var(--ink);
      border:1px solid var(--border); border-radius:14px; padding:16px; box-shadow:0 20px 60px rgba(0,0,0,.25); }
    .modal h3{ margin:0 0 10px 0; font-size:14px; color:var(--ink-soft); }
    .modal .close{ float:right; border:1px solid var(--border); background:transparent;
      border-radius:8px; padding:6px 10px; cursor:pointer; color:var(--ink); }
    .modal footer{ display:flex; gap:10px; justify-content:flex-end; margin-top:12px; flex-wrap:wrap; }
  </style>
</head>
<body>
<header class="topbar">
  <div class="brand">
    <div class="logo"></div>
    <div>
      <h1>PSC Dashboard</h1>
      <small>Help</small>
    </div>
  </div>
  <nav class="tabs">
    <a href="index.html">Dashboard</a>
    <a href="assets.html">Assets</a>
    <a href="agents.html">Agents</a>
    <a href="search.html">Search</a>
    <a href="report.html">Report</a>
    <a href="help.html" class="active">Help</a>
  </nav>
  <button class="theme-toggle" id="themeBtn" title="Toggle theme">üåô Dark</button>
</header>

<main>

  <!-- ===== Overview / Notes ===== -->
  <section class="panel">
    <h2>Overview & Notes</h2>
    <div class="grid-2">
      <div>
        <ul>
          <li>Data is stored locally in your browser via <span class="kbd">localStorage</span>.</li>
          <li>Import CSV files from the <strong>Assets</strong> and <strong>Agents</strong> pages.</li>
          <li>The Dashboard refreshes visuals after you import/filter data.</li>
          <li>Use <strong>Backup</strong> to save your PSC data before resetting.</li>
        </ul>
      </div>
      <div>
        <ul>
          <li>Theme (üåô/‚òÄÔ∏è) is remembered per browser/profile.</li>
          <li>‚ÄúClear All PSC Data‚Äù removes only keys prefixed with <span class="kbd">psc_</span>.</li>
          <li>You can <strong>Restore</strong> a JSON backup at any time.</li>
          <li>Large CSV? Split into smaller files if the browser lags.</li>
        </ul>
      </div>
    </div>
  </section>

  <!-- ===== Importing CSV ===== -->
  <section class="panel">
    <h2>Importing CSV</h2>
    <div class="grid-2">
      <div>
        <h3 style="margin-top:0;color:var(--ink-soft);font-size:13px">Assets CSV ‚Äì example headers</h3>
        <pre>asset_id,address,city,state,price,status,updated_at</pre>
        <div style="color:var(--ink-muted);font-size:12px">Headers must exist. Extra columns are ignored.</div>
      </div>
      <div>
        <h3 style="margin-top:0;color:var(--ink-soft);font-size:13px">Agents CSV ‚Äì example headers</h3>
        <pre>agent_id,full_name,phone,email,license_no,region,updated_at</pre>
        <div style="color:var(--ink-muted);font-size:12px">Make <code>agent_id</code> unique to avoid duplicates.</div>
      </div>
    </div>
    <div style="color:var(--ink-muted);font-size:12px;margin-top:8px">Tip: Save as UTF‚Äë8 and include a header row.</div>
  </section>

  <!-- ===== Data, Backup & Restore ===== -->
  <section class="panel">
    <h2>Data, Backup & Restore</h2>
    <p style="margin-top:0">Your PSC data is saved under keys that begin with <span class="kbd">psc_</span> (e.g., <span class="kbd">psc_assets</span>, <span class="kbd">psc_theme</span>).</p>
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
      <button id="btnBackup" class="btn">Download Backup</button>
      <label class="btn ghost" for="restoreFile" style="display:inline-flex;align-items:center;gap:6px;cursor:pointer">
        ‚¨ÜÔ∏è Restore from JSON
        <input id="restoreFile" type="file" accept="application/json" style="display:none"/>
      </label>
    </div>
    <div id="restoreNote" style="color:var(--ink-muted);font-size:12px;margin-top:8px"></div>
  </section>

  <!-- ===== Troubleshooting ===== -->
  <section class="panel">
    <h2>Troubleshooting</h2>
    <ul>
      <li><strong>Import fails</strong>: Check header names and CSV encoding (UTF‚Äë8). Remove stray commas/quotes.</li>
      <li><strong>No Dashboard change</strong>: Refresh the page after import; ensure IDs aren‚Äôt duplicated.</li>
      <li><strong>Data missing</strong>: Confirm you‚Äôre on the same browser/profile and storage wasn‚Äôt cleared.</li>
      <li><strong>Large files</strong>: Split into smaller batches to avoid unresponsive pages.</li>
    </ul>
  </section>

  <!-- ===== Keyboard Shortcuts ===== -->
  <section class="panel">
    <h2>Keyboard Shortcuts</h2>
    <ul>
      <li><span class="kbd">g</span> then <span class="kbd">d</span> ‚Äì Go to Dashboard</li>
      <li><span class="kbd">g</span> then <span class="kbd">a</span> ‚Äì Go to Assets</li>
      <li><span class="kbd">g</span> then <span class="kbd">n</span> ‚Äì Go to Agents</li>
      <li><span class="kbd">g</span> then <span class="kbd">s</span> ‚Äì Go to Search</li>
      <li><span class="kbd">g</span> then <span class="kbd">r</span> ‚Äì Go to Report</li>
      <li><span class="kbd">?</span> ‚Äì Open Help</li>
    </ul>
  </section>

  <!-- ===== Danger Zone ===== -->
  <section class="panel">
    <h2>Danger Zone</h2>
    <p style="color:var(--ink-muted)">This will remove <strong>ALL</strong> PSC data (keys starting with <span class="kbd">psc_</span>) in this browser only.</p>
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
      <button id="btnConfirmClear" class="btn ghost">Clear All PSC Data</button>
    </div>
  </section>

</main>

<footer class="site-footer">Fully made by Izazi</footer>

<!-- ===== Confirm Modal ===== -->
<div id="confirmModal" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="confirmTitle" aria-describedby="confirmDesc">
    <button class="close" id="closeConfirm">Close</button>
    <h3 id="confirmTitle">Clear all PSC data?</h3>
    <p id="confirmDesc">
      This deletes every <span class="kbd">psc_*</span> entry from your browser. This cannot be undone.<br/>
      We recommend downloading a backup first.
    </p>
    <footer>
      <button class="btn" id="confirmBackup">Download Backup</button>
      <button class="btn" id="cancelClear">Cancel</button>
      <button class="btn danger" id="proceedClear">Delete Everything</button>
    </footer>
  </div>
</div>

<script>
  /* ============== THEME (same as Dashboard) ============== */
  (function initTheme(){
    const saved = localStorage.getItem("psc_theme") || "light";
    if(saved === "dark") document.body.classList.add("dark");
    const btn = document.getElementById("themeBtn");
    const update = () => {
      const dark = document.body.classList.contains("dark");
      btn.textContent = dark ? "‚òÄÔ∏è Light" : "üåô Dark";
      btn.title = dark ? "Switch to Light Mode" : "Switch to Dark Mode";
    };
    btn.addEventListener("click", () => {
      document.body.classList.toggle("dark");
      localStorage.setItem("psc_theme", document.body.classList.contains("dark") ? "dark" : "light");
      update();
    });
    update();
  })();

  /* ============== UTILITIES ============== */
  const $ = id => document.getElementById(id);

  function pscKeys(){
    const out = [];
    for (let i=0;i<localStorage.length;i++){
      const k = localStorage.key(i);
      if (k && k.startsWith("psc_")) out.push(k);
    }
    return out;
  }

  function download(filename, text) {
    const blob = new Blob([text], { type: "application/json;charset=utf-8" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = filename;
    document.body.appendChild(a); a.click();
    a.remove(); URL.revokeObjectURL(url);
  }

  function collectPSC(){
    const data = {};
    pscKeys().forEach(k => {
      const raw = localStorage.getItem(k);
      try { data[k] = JSON.parse(raw); } catch { data[k] = raw; }
    });
    return { version:1, exported_at:new Date().toISOString(), data };
  }

  function restorePSC(obj){
    // Accept either {data:{...}} or {...psc_*}
    const map = obj && obj.data && typeof obj.data === 'object' ? obj.data : obj;
    if (!map || typeof map !== 'object') throw new Error("Invalid backup format");
    const keys = Object.keys(map).filter(k => k.startsWith("psc_"));
    if (!keys.length) throw new Error("No psc_* keys found in file");
    keys.forEach(k => {
      const v = map[k];
      const val = (typeof v === "string") ? v : JSON.stringify(v);
      localStorage.setItem(k, val);
    });
    return keys.length;
  }

  /* ============== Backup / Restore ============== */
  $("btnBackup")?.addEventListener("click", () => {
    const payload = collectPSC();
    const ts = new Date().toISOString().replace(/[:.]/g,"-");
    download(`psc-backup-${ts}.json`, JSON.stringify(payload, null, 2));
  });

  $("restoreFile")?.addEventListener("change", (e) => {
    const file = e.target.files && e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try{
        const obj = JSON.parse(reader.result);
        const count = restorePSC(obj);
        $("restoreNote").textContent = `Restored ${count} PSC key(s). You can now revisit Dashboard/Assets/Agents.`;
      }catch(err){
        console.error(err);
        $("restoreNote").textContent = "Restore failed: " + err.message;
      }finally{
        e.target.value = "";
      }
    };
    reader.readAsText(file);
  });

  /* ============== Confirm Modal Wiring ============== */
  const modal = $("confirmModal");
  function openConfirm(){ modal.style.display = "flex"; modal.setAttribute("aria-hidden","false"); }
  function closeConfirm(){ modal.style.display = "none"; modal.setAttribute("aria-hidden","true"); }

  $("btnConfirmClear")?.addEventListener("click", openConfirm);
  $("closeConfirm")?.addEventListener("click", closeConfirm);
  $("cancelClear")?.addEventListener("click", closeConfirm);
  modal?.addEventListener("click", (e) => { if (e.target === modal) closeConfirm(); });

  $("confirmBackup")?.addEventListener("click", () => {
    const payload = collectPSC();
    const ts = new Date().toISOString().replace(/[:.]/g,"-");
    download(`psc-backup-${ts}.json`, JSON.stringify(payload, null, 2));
  });

  $("proceedClear")?.addEventListener("click", () => {
    try{
      pscKeys().forEach(k => localStorage.removeItem(k));
      closeConfirm();
      setTimeout(()=> alert("All PSC data cleared for this browser."), 10);
    }catch(err){
      closeConfirm();
      setTimeout(()=> alert("Failed to clear PSC data. See console for details."), 10);
      console.error("Clear PSC error:", err);
    }
  });

  /* ============== Simple Page Shortcuts ============== */
  (function shortcuts(){
    let awaitingG = false;
    window.addEventListener("keydown",(e)=>{
      if (e.key.toLowerCase() === "g"){ awaitingG = true; setTimeout(()=> awaitingG=false, 800); return; }
      if (!awaitingG) {
        if (e.key === "?") { window.scrollTo({top:0, behavior:"smooth"}); }
        return;
      }
      const k = e.key.toLowerCase();
      if (k === "d") location.href = "index.html";
      if (k === "a") location.href = "assets.html";
      if (k === "n") location.href = "agents.html";
      if (k === "s") location.href = "search.html";
      if (k === "r") location.href = "report.html";
    });
  })();
</script>
</body>
</html>